<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Zonda by smallsmallwolf</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Zonda</h1>
        <p class="header">Zonda——Degas自家用的前端框架。</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/smallsmallwolf/Zonda/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/smallsmallwolf/Zonda/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/smallsmallwolf/Zonda">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/smallsmallwolf">smallsmallwolf</a></p>


      </header>
      <section>
        <h1>Zonda</h1>

<p><a href="https://travis-ci.org/smallsmallwolf/Zonda"><img src="https://travis-ci.org/smallsmallwolf/Zonda.png?branch=master" alt="Build Status"></a></p>

<hr><p>Zonda——Degas自家用的前端框架。</p>

<p>感谢和我一起建造Zonda的朋友们，亲爱的<a href="http://niko-blog.com/">Niko</a>，<a href="https://github.com/leohgbs">leohgbs</a>，<a href="http://bs.ikm.me/">bronze1man</a>。</p>

<p>BUG还很多，发现一个修复一个。已在几个项目中使用，不断更新，不断学习~</p>

<h2>Zonda行车手册</h2>

<p><strong>目前正在对整车进行重构，处于无法发动状态，技师正在紧张的修复中。</strong></p>

<h3>点火，起步！</h3>

<hr><p><code>git clone https://github.com/smallsmallwolf/Zonda.git</code> 将Zonda拉到Web服务的文件根目录(Web服务器<code>/</code>的位置，放到这里主要是为了方便)，然后执行：</p>

<pre lang="shell"><code>cd Zonda/tool
./build.sh init
</code></pre>

<p>执行完毕后，Zonda会根据<code>Zonda/project-template</code>创建一个前端项目模板，目录结构大致是这样的：</p>

<div class="highlight"><pre><span class="nx">assets</span><span class="o">/</span> <span class="c1"># 前端项目根目录</span>
  <span class="nx">etc</span><span class="o">/</span> <span class="c1"># 项目配置文件  </span>
  <span class="nx">vendor</span><span class="o">/</span> <span class="c1"># 第三方组件</span>
    <span class="nx">Zonda</span><span class="o">/</span>   
  <span class="nx">src</span><span class="o">/</span> <span class="c1"># 你的应用程序源代码 </span>
  <span class="nx">ui</span><span class="o">/</span> <span class="c1"># 你的应用程序的UI文件</span>
    <span class="nx">less</span><span class="o">/</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">less</span>
      <span class="nx">mixin</span><span class="p">.</span><span class="nx">less</span>
      <span class="nx">responsive</span><span class="p">.</span><span class="nx">less</span>
    <span class="nx">images</span><span class="o">/</span>
    <span class="nx">ie</span><span class="o">/</span>
      <span class="nx">ie</span><span class="p">.</span><span class="nx">css</span>      
  <span class="nx">test</span><span class="o">/</span> <span class="c1"># 测试你的应用程序  </span>
  <span class="nx">dist</span><span class="o">/</span> <span class="c1"># 线上版本的应用程序代码</span>
    <span class="nx">dist</span><span class="o">-</span><span class="nx">dev</span><span class="p">.</span><span class="nx">css</span>
    <span class="nx">framework</span><span class="o">-</span><span class="nx">dev</span><span class="p">.</span><span class="nx">js</span>
    <span class="nx">app</span><span class="o">-</span><span class="nx">dev</span><span class="p">.</span><span class="nx">js</span>   
  <span class="nx">tool</span><span class="o">/</span> <span class="c1"># 工具(打包应用程序，Less编译工具等等)</span>
</pre></div>

<p>页面上将要引入的CSS和Javascript文件如下：</p>

<div class="highlight"><pre><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;title&gt;</span>Let's Rock!<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"/assets/dist/dist-dev.css"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

... 

<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/assets/dist/framework-dev.js"</span> <span class="na">id=</span><span class="s">"seajsnode"</span> <span class="na">data-main=</span><span class="s">"/assets/dist/app-dev.js"</span> <span class="nt">&gt;&lt;/script&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<p>Nice，Zonda现在已经发动了，驾驶着它在前端的赛道上驰骋吧~</p>

<h3>CSS/Less &amp; Images</h3>

<hr><p>Less dir: <code>assets/ui/less</code>，放置你的项目的样式</p>

<p>Images dir: <code>assets/ui/images</code>，你项目中用到的图片文件</p>

<p>Bootstrap dir: <code>assets/vendor/Zonda/ui/less</code>，Zonda默认提供使用Bootstrap作为UI基础，在<code>assets/ui/less/config.less</code>中，<code>@import</code>了Bootstrap的Less源文件，如果不需要Bootstrap，可以在<code>config.less</code>将该行注释，但真心不建议这么做，Bootstrap可是个好东西。</p>

<p>Less实时编译工具，这个工具可能有点小Bug，欢迎Issue：</p>

<pre lang="shell"><code>cd assets/tool
./less-compile.sh
</code></pre>

<p>执行上面的命令将会开始监听<code>assets/ui/less</code>目录，如果文件有修改，则会编译，并将所有<code>@import</code>的Less编译成一个CSS文件(包括Bootstrap和Font Awesome)输出到<code>assets/dist/dist-dev.css</code>，也就是页面上引入的那个CSS文件。</p>

<p>Less编译工具使用NodeJs(v0.8.21)和Lessc(v1.3.3)，源文件在<code>tool/module/lessCompiler.coffee</code>。它目前只能提供简单的监听文件改变并编译的功能，并且将所有的Less文件编译成一个CSS。</p>

<p><code>lessCompiler.coffee</code>默认会将Less中的注释去掉，如果需要保留注释以便调试，则将文件中的：</p>

<div class="highlight"><pre><span class="nv">lessc_command = </span><span class="s">"lessc -x"</span>
<span class="c1"># 去掉 -x，改成下面这样即可</span>
<span class="nv">lessc_command = </span><span class="s">"lessc"</span>
</pre></div>

<p><code>lessCompiler.coffee</code>缺少一个不将Less合并成一个CSS的功能，还缺少将<code>dist-dev.css</code>压缩的功能，以后会尝试实现的，欢迎Issue~</p>

<h3>JavaScript</h3>

<hr><p>Javascript dir: <code>assets/src</code>，这里放置你的项目源代码。如果使用CoffeeScript，那么直接将Coffee文件编译到当前目录下就行了，推荐一个Vim-CoffeeScript插件<a href="https://github.com/kchmck/vim-coffee-script">vim-coffee-script</a></p>

<p>Zonda dir: <code>assets/vendor/Zonda</code>，这里是Zonda的框架代码，框架里已经包含了一些必要的库，都已做成seajs module，包括：</p>

<pre><code>SeaJs v2.0.0pre
jQuery v1.9.1
Underscore
Backbone
Bootstrap(jQuery plugins)
Mustache
</code></pre>

<h3>开发模式(dev)与线上模式(prod)</h3>

<hr><pre lang="shell"><code>cd assets/tool/

# 切换至开发模式：生成 framework-dev.js，app-dev.js
./build.sh dev

# 切换至线上模式：生成 framework-version.js，app-version.js
./build.sh prod
</code></pre>

<p><strong>DEV模式</strong></p>

<p>期望实现的目标：不压缩合并任何应用代码和第三方模块。</p>

<p><code>/assets/dist/framework-dev.js</code>
实现思路：
在开发模式下(dev)，该文件就是 SeaJs 源码 + SeaJs plugin(没有加入 combo，flush插件);
SeaJs 的配置文件为 env.js (以后有时间了可以考虑使用 Yaml，或者直接 CoffeeScript )，用工具将 <code>assets/vendor/Zonda/vendor</code> 以及 <code>assets/vendor/</code> 读取一遍，生成出 env.js 需要使用的 SeaJs 的 <code>alias</code>，然后将生成好的 env.js cat 到 SeaJs 源代码底部，当有第三方模块更新，或者 SeaJs 更新时，只需要重新执行 <code>./build.sh dev</code> 即可。</p>

<p>env.js 应该大概是这个样子：</p>

<div class="highlight"><pre><span class="nx">seajs</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
  <span class="nx">base</span><span class="o">:</span> <span class="s2">"/assets"</span><span class="p">,</span>
  <span class="nx">alias</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">"jquery"</span> <span class="o">:</span> <span class="s2">"vendor/Zonda/vendor/jquery/1.9.1/jquery/src/jquery"</span>
  <span class="p">},</span>
  <span class="nx">charset</span><span class="o">:</span> <span class="s2">"utf-8"</span>
<span class="p">});</span>
</pre></div>

<p><code>assets/dist/app-dev.js</code>
实现思路：
在开发模式下(dev)，该文件只有一行：</p>

<div class="highlight"><pre><span class="nx">seajs</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">"/assets/src/app"</span><span class="p">);</span>
</pre></div>

<p><strong>PROD模式</strong></p>

<p>期望实现的目标：将 SeaJS，jQuery 等第三方模块压缩合并到<code>framework-version.js</code>，将<code>src</code>下应用程序源码压缩合并到<code>app-version.js</code>，最终将 Javascript 文件的连接数优化为2个，并且带有文件MD5值的版本号，以便控制其发布。</p>

<p><code>assets/dist/framework-version.js</code>
实现思路：
在线上模式(prod)，该文件包含了<code>framework-dev.js</code>，<code>vendor/</code>下的各个第三方模块。</p>

<p><code>assets/dist/app-version.js</code>
实现思路：
在线上模式(prod)，该文件为<code>assets/src/app-version.js</code>将其<code>src</code>内的依赖打包合并后的文件，需要在最后一行加上：</p>

<div class="highlight"><pre><span class="nx">seajs</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">"/assets/dist/app.js"</span><span class="p">);</span>
</pre></div>

<p>以便 SeaJS 将它视作应用入口。</p>

<p><strong>spm build</strong></p>

<p>这里使用<code>spm</code>工具来实现 prod 模式，但是 spm 没有实现这里"将第三方模块与应用程序代码分别打包"的需求，所以目前只能手动解决，那就是配置<code>package.json</code>：</p>

<div class="highlight"><pre><span class="p">{</span>
  <span class="nt">"name"</span> <span class="p">:</span> <span class="s2">"Zonda-Project"</span><span class="p">,</span>
  <span class="nt">"version"</span> <span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
  <span class="nt">"root"</span><span class="p">:</span> <span class="s2">"/assets/dist"</span><span class="p">,</span>
  <span class="nt">"dependencies"</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">"jquery"</span> <span class="p">:</span> <span class="s2">"jquery"</span>
  <span class="p">},</span>
  <span class="nt">"output"</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">"app.js"</span> <span class="p">:</span> <span class="s2">"."</span>
  <span class="p">},</span>
  <span class="nt">"sources"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"http://module.zonda.dashu.us:22221"</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

<p>这里对<code>require("jquery")</code>这样的第三方依赖没有做处理，是因为<code>jquery</code>模块已经打包压缩到<code>framework-version.js</code>中了，并且其模块ID为<code>env.js</code>中配置的<code>alias</code>所指明的ID。所以<code>app-version.js</code>中调用<code>require("jquery")</code>时会根据<code>seajs.config</code>中<code>alias</code>的配置去调用，这里就没有问题了。</p>

<p>需要注意的是这里将第三方模块打包到<code>framework-version.js</code>是由Zonda的工具来完成的，并不是由spm，所以<code>framework-version.js</code>里到底 combo 了哪些第三方模块，已经这些模块的顺序，全部都由<code>etc/package.json</code>中的<code>dependencies</code>决定的。</p>

<h3>调用框架模块</h3>

<p>doing</p>

<h3>使用Qunit和Sinon测试</h3>

<p>doing</p>

<h3>升级Zonda</h3>

<p>doing</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>